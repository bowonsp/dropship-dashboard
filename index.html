<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Safe Dropship Automation Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
  <div class="max-w-7xl mx-auto p-4">
    <!-- Header -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
      <div class="flex items-center justify-between mb-4">
        <div>
          <h1 class="text-3xl font-bold text-gray-800">üõ°Ô∏è Safe Dropship Automation</h1>
          <p class="text-gray-600 mt-2">Full automation dengan keamanan marketplace terjamin</p>
        </div>
        <button onclick="handleRefresh()" id="refreshBtn" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition">
          üîÑ Refresh
        </button>
      </div>
      
      <!-- Tabs -->
      <div class="flex gap-2 overflow-x-auto pb-2">
        <button onclick="switchTab('dashboard')" id="tab-dashboard" class="px-4 py-2 rounded-lg font-medium transition whitespace-nowrap bg-blue-600 text-white">
          üìä Dashboard
        </button>
        <button onclick="switchTab('trends')" id="tab-trends" class="px-4 py-2 rounded-lg font-medium transition whitespace-nowrap bg-gray-100 text-gray-700 hover:bg-gray-200">
          üî• Trends
        </button>
        <button onclick="switchTab('analytics')" id="tab-analytics" class="px-4 py-2 rounded-lg font-medium transition whitespace-nowrap bg-gray-100 text-gray-700 hover:bg-gray-200">
          üìà Analytics
        </button>
        <button onclick="switchTab('queue')" id="tab-queue" class="px-4 py-2 rounded-lg font-medium transition whitespace-nowrap bg-gray-100 text-gray-700 hover:bg-gray-200">
          ‚úÖ Queue (<span id="queueCount">0</span>)
        </button>
      </div>
    </div>

    <!-- Dashboard Content -->
    <div id="content-dashboard" class="space-y-6">
      <!-- Stats -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div class="bg-white rounded-lg shadow p-4">
          <p class="text-gray-600 text-sm">Total Products</p>
          <p class="text-2xl font-bold text-blue-600 mt-2">38</p>
          <p class="text-xs text-green-600 mt-1">+18.5% this week</p>
        </div>
        <div class="bg-white rounded-lg shadow p-4">
          <p class="text-gray-600 text-sm">Total Revenue</p>
          <p class="text-xl font-bold text-green-600 mt-2">Rp 4.350k</p>
        </div>
        <div class="bg-white rounded-lg shadow p-4">
          <p class="text-gray-600 text-sm">Total Profit</p>
          <p class="text-xl font-bold text-purple-600 mt-2">Rp 1.341k</p>
        </div>
        <div class="bg-white rounded-lg shadow p-4">
          <p class="text-gray-600 text-sm">Posted Today</p>
          <p class="text-2xl font-bold text-orange-600 mt-2">12/15</p>
        </div>
      </div>

      <!-- Safety Banner -->
      <div class="bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6">
        <h3 class="text-xl font-bold text-green-800 mb-2">üõ°Ô∏è Safety Mode: ACTIVE</h3>
        <p class="text-green-700 text-sm mb-4">Sistem berjalan dengan proteksi penuh terhadap ToS marketplace</p>
        <div class="grid md:grid-cols-3 gap-4">
          <div class="bg-white rounded-lg p-3 border border-green-200">
            <p class="text-sm text-gray-600">Daily Limit</p>
            <p class="text-lg font-bold text-green-600">15 produk/hari</p>
          </div>
          <div class="bg-white rounded-lg p-3 border border-green-200">
            <p class="text-sm text-gray-600">Random Delays</p>
            <p class="text-lg font-bold text-green-600">3-8 detik</p>
          </div>
          <div class="bg-white rounded-lg p-3 border border-green-200">
            <p class="text-sm text-gray-600">Working Hours</p>
            <p class="text-lg font-bold text-green-600">8:00-22:00</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Trends Content -->
    <div id="content-trends" class="hidden">
      <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="p-6 border-b bg-gradient-to-r from-blue-600 to-indigo-600">
          <h2 class="text-xl font-bold text-white">üî• Trending Categories</h2>
          <p class="text-blue-100 text-sm mt-1">Klik "Add to Queue" untuk menambahkan produk</p>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Rank</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Category</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Growth</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Volume</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Competition</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Action</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200" id="trendsTable">
              <!-- Will be populated by JS -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Analytics Content -->
    <div id="content-analytics" class="hidden">
      <div class="bg-white rounded-xl shadow-lg p-6">
        <h2 class="text-2xl font-bold mb-6">üìà Sales Analytics</h2>
        <div class="grid md:grid-cols-2 gap-6">
          <div class="border rounded-lg p-4">
            <h3 class="font-semibold mb-3">Performance Overview</h3>
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-gray-600">Conversion Rate</span>
                <span class="font-bold text-blue-600">2.8%</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Avg Order Value</span>
                <span class="font-bold text-green-600">Rp 121.389</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Total Orders</span>
                <span class="font-bold text-purple-600">38</span>
              </div>
            </div>
          </div>
          <div class="border rounded-lg p-4">
            <h3 class="font-semibold mb-3">Growth Metrics</h3>
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-gray-600">Weekly Growth</span>
                <span class="font-bold text-green-600">+18.5%</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">New Products</span>
                <span class="font-bold text-blue-600">12 this week</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Active Listings</span>
                <span class="font-bold text-purple-600">35</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Queue Content -->
    <div id="content-queue" class="hidden">
      <div class="bg-white rounded-xl shadow-lg p-6">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold">‚úÖ Product Queue Manager</h2>
          <button onclick="exportQueue()" id="exportBtn" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition">
            üì• Export Approved (<span id="approvedCount">0</span>)
          </button>
        </div>
        <div id="queueList"></div>
      </div>
    </div>
  </div>

  <script>
    // Data
    const trends = [
      { id: 1, name: 'Fashion Muslim', growth: 145, volume: 125000, competition: 'medium', avgPrice: 85000 },
      { id: 2, name: 'Gadget Accessories', growth: 132, volume: 98000, competition: 'high', avgPrice: 45000 },
      { id: 3, name: 'Skincare Korea', growth: 128, volume: 156000, competition: 'high', avgPrice: 120000 },
      { id: 4, name: 'Alat Dapur', growth: 118, volume: 78000, competition: 'medium', avgPrice: 65000 },
      { id: 5, name: 'Mainan Edukasi', growth: 115, volume: 67000, competition: 'low', avgPrice: 95000 }
    ];

    let productQueue = [];
    let currentTab = 'dashboard';

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      renderTrends();
      updateQueueDisplay();
      console.log('Dashboard initialized - all buttons should work!');
    });

    // Switch Tab
    function switchTab(tab) {
      console.log('Switching to tab:', tab);
      
      // Hide all content
      document.getElementById('content-dashboard').classList.add('hidden');
      document.getElementById('content-trends').classList.add('hidden');
      document.getElementById('content-analytics').classList.add('hidden');
      document.getElementById('content-queue').classList.add('hidden');
      
      // Show selected content
      document.getElementById('content-' + tab).classList.remove('hidden');
      
      // Update tab buttons
      ['dashboard', 'trends', 'analytics', 'queue'].forEach(t => {
        const btn = document.getElementById('tab-' + t);
        if (t === tab) {
          btn.classList.remove('bg-gray-100', 'text-gray-700');
          btn.classList.add('bg-blue-600', 'text-white');
        } else {
          btn.classList.remove('bg-blue-600', 'text-white');
          btn.classList.add('bg-gray-100', 'text-gray-700');
        }
      });
      
      currentTab = tab;
    }

    // Refresh
    function handleRefresh() {
      console.log('Refresh clicked');
      const btn = document.getElementById('refreshBtn');
      btn.textContent = '‚è≥ Loading...';
      btn.disabled = true;
      
      setTimeout(() => {
        btn.textContent = 'üîÑ Refresh';
        btn.disabled = false;
        alert('‚úÖ Data berhasil di-refresh!');
      }, 1000);
    }

    // Render Trends Table
    function renderTrends() {
      const tbody = document.getElementById('trendsTable');
      tbody.innerHTML = trends.map((trend, idx) => `
        <tr class="hover:bg-gray-50">
          <td class="px-6 py-4">
            <span class="font-bold ${idx < 3 ? 'text-yellow-600' : 'text-gray-500'}">#${idx + 1}</span>
          </td>
          <td class="px-6 py-4 font-medium text-gray-900">${trend.name}</td>
          <td class="px-6 py-4 text-green-600 font-semibold">${trend.growth}%</td>
          <td class="px-6 py-4">${trend.volume.toLocaleString('id-ID')}</td>
          <td class="px-6 py-4">
            <span class="px-3 py-1 rounded-full text-xs font-medium ${
              trend.competition === 'low' ? 'bg-green-100 text-green-700' :
              trend.competition === 'medium' ? 'bg-yellow-100 text-yellow-700' :
              'bg-red-100 text-red-700'
            }">
              ${trend.competition}
            </span>
          </td>
          <td class="px-6 py-4">
            <button onclick="addToQueue(${trend.id})" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm">
              Add to Queue
            </button>
          </td>
        </tr>
      `).join('');
    }

    // Add to Queue
    function addToQueue(trendId) {
      console.log('Adding to queue:', trendId);
      const trend = trends.find(t => t.id === trendId);
      if (!trend) return;
      
      const modalPrice = Math.round(trend.avgPrice * 0.7);
      const markup = 35;
      const sellingPrice = modalPrice + Math.round(modalPrice * markup / 100);
      const profit = sellingPrice - modalPrice;
      
      const product = {
        id: Date.now(),
        productName: trend.name + ' Premium',
        category: trend.name,
        modalPrice: modalPrice,
        sellingPrice: sellingPrice,
        profit: profit,
        status: 'pending',
        addedAt: new Date().toLocaleString('id-ID')
      };
      
      productQueue.push(product);
      updateQueueDisplay();
      alert(`‚úÖ "${product.productName}" ditambahkan ke queue!`);
    }

    // Update Queue Display
    function updateQueueDisplay() {
      document.getElementById('queueCount').textContent = productQueue.length;
      
      const approvedCount = productQueue.filter(p => p.status === 'approved').length;
      document.getElementById('approvedCount').textContent = approvedCount;
      
      const queueList = document.getElementById('queueList');
      
      if (productQueue.length === 0) {
        queueList.innerHTML = `
          <div class="text-center py-12 text-gray-500">
            <div class="text-6xl mb-4">üì¶</div>
            <p class="text-lg font-medium">Queue kosong</p>
            <p class="text-sm mt-2">Tambahkan produk dari tab Trends</p>
          </div>
        `;
      } else {
        queueList.innerHTML = productQueue.map(item => `
          <div class="border rounded-lg p-4 mb-4">
            <div class="flex justify-between items-start mb-3">
              <div>
                <h3 class="font-bold text-lg">${item.productName}</h3>
                <p class="text-sm text-gray-600">${item.category} ‚Ä¢ ${item.addedAt}</p>
              </div>
              <span class="px-3 py-1 rounded-full text-xs font-medium ${
                item.status === 'approved' ? 'bg-green-100 text-green-700' :
                item.status === 'rejected' ? 'bg-red-100 text-red-700' :
                'bg-yellow-100 text-yellow-700'
              }">
                ${item.status}
              </span>
            </div>
            <div class="grid md:grid-cols-3 gap-4 bg-gray-50 rounded p-3 mb-3">
              <div>
                <p class="text-sm text-gray-600">Modal</p>
                <p class="font-bold text-red-600">Rp ${item.modalPrice.toLocaleString('id-ID')}</p>
              </div>
              <div>
                <p class="text-sm text-gray-600">Harga Jual</p>
                <p class="font-bold text-green-600">Rp ${item.sellingPrice.toLocaleString('id-ID')}</p>
              </div>
              <div>
                <p class="text-sm text-gray-600">Profit</p>
                <p class="font-bold text-blue-600">Rp ${item.profit.toLocaleString('id-ID')}</p>
              </div>
            </div>
            <div class="flex gap-2">
              ${item.status === 'pending' ? `
                <button onclick="approveProduct(${item.id})" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition text-sm">
                  ‚úì Approve
                </button>
                <button onclick="rejectProduct(${item.id})" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition text-sm">
                  ‚úó Reject
                </button>
              ` : ''}
              <button onclick="removeProduct(${item.id})" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition text-sm">
                Remove
              </button>
            </div>
          </div>
        `).join('');
      }
    }

    // Approve Product
    function approveProduct(id) {
      console.log('Approving product:', id);
      const product = productQueue.find(p => p.id === id);
      if (product) {
        product.status = 'approved';
        updateQueueDisplay();
      }
    }

    // Reject Product
    function rejectProduct(id) {
      console.log('Rejecting product:', id);
      const product = productQueue.find(p => p.id === id);
      if (product) {
        product.status = 'rejected';
        updateQueueDisplay();
      }
    }

    // Remove Product
    function removeProduct(id) {
      console.log('Removing product:', id);
      productQueue = productQueue.filter(p => p.id !== id);
      updateQueueDisplay();
    }

    // Export Queue
    function exportQueue() {
      console.log('Exporting queue');
      const approved = productQueue.filter(p => p.status === 'approved');
      
      if (approved.length === 0) {
        alert('‚ùå Tidak ada produk yang di-approve untuk di-export!');
        return;
      }
      
      const data = {
        products: approved,
        safetySettings: {
          maxPostPerDay: 15,
          minDelaySeconds: 3,
          maxDelaySeconds: 8,
          workingHoursStart: 8,
          workingHoursEnd: 22
        },
        exportedAt: new Date().toISOString()
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'dropship-export-' + Date.now() + '.json';
      a.click();
      
      alert(`‚úÖ ${approved.length} produk berhasil di-export!\n\nFile siap untuk Chrome Extension.`);
    }

    console.log('All functions loaded successfully!');
  </script>
</body>
</html>
